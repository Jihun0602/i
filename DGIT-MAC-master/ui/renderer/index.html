<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DGit MAC</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #1e1e1e;
            --bg-secondary: #2d2d2d;
            --bg-tertiary: #3d3d3d;
            --text-primary: #ffffff;
            --text-secondary: #a0a0a0;
            --accent-blue: #007aff;
            --accent-green: #34c759;
            --accent-red: #ff3b30;
            --accent-orange: #ff9500;
            --border-color: #404040;
            --hover-bg: #404040;
        }

        [data-theme="light"] {
            --bg-primary: #ffffff;
            --bg-secondary: #f5f5f5;
            --bg-tertiary: #e5e5e5;
            --text-primary: #000000;
            --text-secondary: #666666;
            --border-color: #d0d0d0;
            --hover-bg: #e5e5e5;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            height: 100vh;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        /* ë¡œë”© í™”ë©´ */
        .splash-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--bg-primary);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        .splash-logo {
            font-size: 5rem;
            font-weight: 300;
            margin-bottom: 2rem;
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-green));
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .splash-loading {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.1rem;
            color: var(--text-secondary);
        }

        .loading-dots {
            display: flex;
            gap: 4px;
        }

        .loading-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--accent-blue);
            animation: loadingPulse 1.4s infinite ease-in-out both;
        }

        .loading-dot:nth-child(1) { animation-delay: -0.32s; }
        .loading-dot:nth-child(2) { animation-delay: -0.16s; }

        @keyframes loadingPulse {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1); }
        }

        /* ë©”ì¸ ì•± ì»¨í…Œì´ë„ˆ */
        .app-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            opacity: 0;
            transition: opacity 0.3s ease;
            position: relative;
            z-index: 1;
        }

        .app-container.visible {
            opacity: 1;
        }

        /* íƒ€ì´í‹€ë°” */
        .title-bar {
            height: 28px;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            -webkit-app-region: drag;
            position: relative;
            padding: 0;
            z-index: 1000;
        }


        .title-text {
            flex: 1;
            text-align: center;
            font-size: 13px;
            font-weight: 500;
            color: var(--text-primary);
        }

        .theme-toggle {
            -webkit-app-region: no-drag;
            background: none;
            border: none;
            color: var(--text-secondary);
            flex-shrink: 0;
            cursor: pointer;
            padding: 4px 16px;
            border-radius: 4px;
            transition: all 0.2s ease;
        }

        .theme-toggle:hover {
            background: var(--hover-bg);
        }

        /* ë©”ì¸ í™”ë©´ */
        .home-screen {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px;
        }

        .home-logo {
            font-size: 5rem;
            font-weight: 600;
            margin-bottom: 1rem;
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-green));
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1rem;
        }

        .home-logo-icon {
            width: 80px;
            height: 80px;
            background-image: url('assets/icon.png');
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
        }

        .home-subtitle {
            font-size: 1.1rem;
            color: var(--text-secondary);
            margin-bottom: 3rem;
        }

        .home-buttons {
            display: flex;
            flex-direction: column;
            gap: 16px;
            width: 100%;
            max-width: 400px;
        }

        .home-button {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 16px 20px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            text-decoration: none;
            color: var(--text-primary);
        }

        .home-button:hover {
            background: var(--hover-bg);
            transform: translateY(-1px);
        }

        .home-button-icon {
            font-size: 1.2rem;
        }

        .home-button-text {
            flex: 1;
        }

        .home-button-title {
            font-weight: 500;
            margin-bottom: 4px;
        }

        .home-button-desc {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        /* í”„ë¡œì íŠ¸ ì‘ì—… í™”ë©´ */
        .workspace {
            flex: 1;
            display: none;
            flex-direction: column;
        }

        .workspace.active {
            display: flex;
        }

        .workspace-header {
            height: 60px;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            padding: 0 20px;
            gap: 16px;
        }

        .project-info h2 {
            font-size: 1.2rem;
            font-weight: 500;
        }

        .project-path {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .workspace-content {
            flex: 1;
            display: flex;
        }

        .sidebar {
            width: 200px;
            background: var(--bg-secondary);
            border-right: 1px solid var(--border-color);
            padding: 20px 0;
        }

        .sidebar-nav {
            list-style: none;
        }

        .sidebar-item {
            padding: 10px 20px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .sidebar-item:hover,
        .sidebar-item.active {
            background: var(--hover-bg);
        }

        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .content-area {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }

        .terminal-panel {
            height: 200px;
            background: var(--bg-tertiary);
            border-top: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
        }

        .terminal-header {
            height: 40px;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            padding: 0 16px;
        }

        .terminal-tabs {
            display: flex;
            gap: 16px;
        }

        .terminal-tab {
            padding: 8px 12px;
            cursor: pointer;
            border-radius: 4px;
            transition: all 0.2s ease;
            font-size: 0.9rem;
        }

        .terminal-tab.active {
            background: var(--hover-bg);
        }

        .terminal-content {
            flex: 1;
            padding: 12px;
            font-family: 'SF Mono', Monaco, monospace;
            font-size: 12px;
            overflow-y: auto;
        }

        /* íŒŒì¼ ë¦¬ìŠ¤íŠ¸ */
        .file-list {
            display: grid;
            gap: 8px;
        }

        .file-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .file-item:hover {
            background: var(--hover-bg);
        }

        .file-thumbnail {
            width: 40px;
            height: 40px;
            background: var(--bg-tertiary);
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        .file-info {
            flex: 1;
        }

        .file-name {
            font-weight: 500;
            margin-bottom: 4px;
        }

        .file-details {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .file-status {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--accent-green);
        }

        /* ì»¤ë°‹ íˆìŠ¤í† ë¦¬ */
        .commit-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .commit-item {
            display: flex;
            gap: 12px;
            padding: 16px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
        }

        .commit-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--accent-blue);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 500;
        }

        .commit-details {
            flex: 1;
        }

        .commit-message {
            font-weight: 500;
            margin-bottom: 6px;
        }

        .commit-meta {
            font-size: 0.9rem;
            color: var(--text-secondary);
            display: flex;
            gap: 16px;
        }

        .commit-thumbnail {
            width: 60px;
            height: 40px;
            background: var(--bg-tertiary);
            border-radius: 4px;
            border: 1px solid var(--border-color);
        }

        /* ëª¨ë‹¬ */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal-overlay.show {
            display: flex;
        }

        .modal {
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 24px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 1.3rem;
            font-weight: 500;
            margin-bottom: 8px;
        }

        .modal-subtitle {
            color: var(--text-secondary);
        }

        .modal-body {
            margin-bottom: 24px;
        }

        .modal-footer {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }

        /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.2s ease;
        }

        .btn-primary {
            background: var(--accent-blue);
            color: white;
        }

        .btn-primary:hover {
            background: #0056cc;
        }

        .btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .btn-secondary:hover {
            background: var(--hover-bg);
        }

        /* í† ìŠ¤íŠ¸ ì•Œë¦¼ */
        .toast-container {
            position: fixed;
            top: 40px;
            right: 20px;
            z-index: 2000;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .toast {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 12px 16px;
            display: flex;
            align-items: center;
            gap: 10px;
            min-width: 300px;
            animation: toastSlideIn 0.3s ease;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .toast.success { border-left: 4px solid var(--accent-green); }
        .toast.error { border-left: 4px solid var(--accent-red); }
        .toast.warning { border-left: 4px solid var(--accent-orange); }

        @keyframes toastSlideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* ë¸Œëœì¹˜ ì‹œê°í™” */
        .branch-graph {
            height: 300px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
        }

        .branch-node {
            position: absolute;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--accent-blue);
            border: 2px solid var(--bg-primary);
        }

        .branch-line {
            position: absolute;
            height: 2px;
            background: var(--accent-blue);
        }

        /* ë°˜ì‘í˜• */
        @media (max-width: 768px) {
            .workspace-content {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                height: auto;
            }
            
            .terminal-panel {
                height: 150px;
            }
        }

        /* ìˆ¨ê¹€ í´ë˜ìŠ¤ */
        .hidden {
            display: none;
        }
    </style>
</head>
<body data-theme="dark">
    <!-- ë¡œë”© í™”ë©´ -->
    <div class="splash-screen" id="splashScreen">
        <div class="splash-logo">DGit</div>
        <div class="splash-loading">
            <span>ë¡œë”© ì¤‘</span>
            <div class="loading-dots">
                <div class="loading-dot"></div>
                <div class="loading-dot"></div>
                <div class="loading-dot"></div>
            </div>
        </div>
    </div>

    <!-- ë©”ì¸ ì•± -->
    <div class="app-container" id="appContainer">
        <!-- íƒ€ì´í‹€ë°” -->
        <div class="title-bar">
            <div class="title-text" id="titleText">DGit MAC</div>
            <button class="theme-toggle" onclick="toggleTheme()">
                <span id="themeIcon">ğŸŒ™</span>
            </button>
        </div>

        <!-- í™ˆ í™”ë©´ -->
        <div class="home-screen" id="homeScreen">
            <div class="home-logo">
                <div class="home-logo-icon"></div>
                DGit
            </div>
            <div class="home-subtitle">ë””ìì¸ íŒŒì¼ ì „ìš© ë²„ì „ ê´€ë¦¬ ì‹œìŠ¤í…œ</div>
            <div class="home-buttons">
                <div class="home-button" onclick="selectNewProject()">
                    <div class="home-button-icon">âœ…</div>
                    <div class="home-button-text">
                        <div class="home-button-title">ìƒˆ í”„ë¡œì íŠ¸ ì„ íƒ</div>
                        <div class="home-button-desc">ìƒˆë¡œìš´ ë””ìì¸ í”„ë¡œì íŠ¸ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤</div>
                    </div>
                </div>
                <div class="home-button" onclick="openCurrentProject()">
                    <div class="home-button-icon">ğŸ“‚</div>
                    <div class="home-button-text">
                        <div class="home-button-title">ì§„í–‰ ì¤‘ì¸ í”„ë¡œì íŠ¸</div>
                        <div class="home-button-desc">ê°€ì¥ ìµœê·¼ í”„ë¡œì íŠ¸ë¥¼ ë°”ë¡œ ì—½ë‹ˆë‹¤</div>
                    </div>
                </div>
                <div class="home-button" onclick="showRecentProjects()">
                    <div class="home-button-icon">ğŸ•˜</div>
                    <div class="home-button-text">
                        <div class="home-button-title">ì§€ë‚œ í”„ë¡œì íŠ¸</div>
                        <div class="home-button-desc">ìµœê·¼ ì‘ì—…í•œ í”„ë¡œì íŠ¸ ëª©ë¡ì—ì„œ ì„ íƒ</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ì‘ì—… ê³µê°„ -->
        <div class="workspace" id="workspace">
            <!-- í—¤ë” -->
            <div class="workspace-header">
                <button class="btn btn-secondary" onclick="goHome()">â† í™ˆ</button>
                <div class="project-info">
                    <h2 id="projectName">í”„ë¡œì íŠ¸ëª…</h2>
                    <div class="project-path" id="projectPath">/path/to/project</div>
                </div>
            </div>

            <!-- ì½˜í…ì¸  ì˜ì—­ -->
            <div class="workspace-content">
                <!-- ì‚¬ì´ë“œë°” -->
                <div class="sidebar">
                    <ul class="sidebar-nav">
                        <li class="sidebar-item active" onclick="showContent('files')">
                            <span>ğŸ“</span> íŒŒì¼
                        </li>
                        <li class="sidebar-item" onclick="showContent('versions')">
                            <span>ğŸ“</span> ë²„ì „
                        </li>
                        <li class="sidebar-item" onclick="showContent('branches')">
                            <span>ğŸŒ¿</span> ë¸Œëœì¹˜
                        </li>
                        <li class="sidebar-item" onclick="showContent('notifications')">
                            <span>ğŸ””</span> ì•Œë¦¼
                        </li>
                        <li class="sidebar-item" onclick="showContent('settings')">
                            <span>âš™ï¸</span> ì„¤ì •
                        </li>
                    </ul>
                </div>

                <!-- ë©”ì¸ ì½˜í…ì¸  -->
                <div class="main-content">
                    <div class="content-area">
                        <!-- íŒŒì¼ ëª©ë¡ -->
                        <div id="filesContent" class="content-section">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                                <h3>í”„ë¡œì íŠ¸ íŒŒì¼</h3>
                                <div style="display: flex; gap: 8px;">
                                    <button class="btn btn-secondary" onclick="changeProject()">í”„ë¡œì íŠ¸ ë³€ê²½</button>
                                    <button class="btn btn-secondary" onclick="scanProject()">ìŠ¤ìº”</button>
                                    <button class="btn btn-secondary" onclick="addAllFiles()">ëª¨ë“  íŒŒì¼ ì¶”ê°€</button>
                                    <button class="btn btn-secondary" onclick="restoreFiles()">ë³µì›</button>
                                    <button class="btn btn-secondary" onclick="showInFinder()">Finderì—ì„œ ë³´ê¸°</button>
                                    <button class="btn btn-primary" onclick="commitChanges()">ë³€ê²½ì‚¬í•­ ì»¤ë°‹</button>
                                </div>
                            </div>
                            <div class="file-list" id="fileList">
                                <!-- íŒŒì¼ í•­ëª©ë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                            </div>
                        </div>

                        <!-- ë²„ì „ íˆìŠ¤í† ë¦¬ -->
                        <div id="versionsContent" class="content-section hidden">
                            <h3 style="margin-bottom: 20px;">ì»¤ë°‹ íˆìŠ¤í† ë¦¬</h3>
                            <div class="commit-list" id="commitList">
                                <!-- ì»¤ë°‹ í•­ëª©ë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                            </div>
                        </div>

                        <!-- ë¸Œëœì¹˜ ê´€ë¦¬ -->
                        <div id="branchesContent" class="content-section hidden">
                            <h3 style="margin-bottom: 20px;">ë¸Œëœì¹˜ ê´€ë¦¬</h3>
                            <div class="branch-graph" id="branchGraph"></div>
                            <button class="btn btn-primary" onclick="createBranch()">ìƒˆ ë¸Œëœì¹˜ ìƒì„±</button>
                        </div>

                        <!-- ì•Œë¦¼ -->
                        <div id="notificationsContent" class="content-section hidden">
                            <h3 style="margin-bottom: 20px;">ì•Œë¦¼ ì„¤ì •</h3>
                            <p>ì•Œë¦¼ ê´€ë ¨ ì„¤ì •ë“¤ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</p>
                        </div>

                        <!-- ì„¤ì • -->
                        <div id="settingsContent" class="content-section hidden">
                            <h3 style="margin-bottom: 20px;">í™˜ê²½ì„¤ì •</h3>
                            <div style="margin-bottom: 20px;">
                                <h4 style="margin-bottom: 10px;">ì •ë³´</h4>
                                <p style="color: var(--text-secondary); margin-bottom: 8px;">ë²„ì „: 1.0.0</p>
                                <p style="color: var(--text-secondary); margin-bottom: 8px;">ì œì‘: 3pxTeam</p>
                            </div>
                            <div>
                                <h4 style="margin-bottom: 10px;">í…Œë§ˆ</h4>
                                <button class="btn btn-secondary" onclick="toggleTheme()">
                                    <span id="themeText">ë¼ì´íŠ¸ ëª¨ë“œë¡œ ì „í™˜</span>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- í„°ë¯¸ë„ íŒ¨ë„ -->
                    <div class="terminal-panel">
                        <div class="terminal-header">
                            <div class="terminal-tabs">
                                <div class="terminal-tab active" onclick="showTerminalTab('log')">ì»¤ë°‹ ë¡œê·¸</div>
                                <div class="terminal-tab" onclick="showTerminalTab('status')">ìƒíƒœ</div>
                            </div>
                        </div>
                        <div class="terminal-content" id="terminalContent">
                            <div id="terminalLog">ì»¤ë°‹ ë¡œê·¸ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...</div>
                            <div id="terminalStatus" class="hidden">ìƒíƒœ ì •ë³´ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ëª¨ë‹¬ë“¤ -->
    <div class="modal-overlay" id="modalOverlay">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title" id="modalTitle">ëª¨ë‹¬ ì œëª©</div>
                <div class="modal-subtitle" id="modalSubtitle">ëª¨ë‹¬ ë¶€ì œëª©</div>
            </div>
            <div class="modal-body" id="modalBody">
                ëª¨ë‹¬ ë‚´ìš©
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal()">ì·¨ì†Œ</button>
                <button class="btn btn-primary" onclick="confirmModal()">í™•ì¸</button>
            </div>
        </div>
    </div>

    <!-- í† ìŠ¤íŠ¸ ì»¨í…Œì´ë„ˆ -->
    <div class="toast-container" id="toastContainer"></div>

    <script>
        // ì „ì—­ ë³€ìˆ˜
        let currentProject = null;
        let currentTheme = 'dark';
        let activeContent = 'files';

        // ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            // ë¡œë”© í™”ë©´ í‘œì‹œ í›„ ë©”ì¸ ì•±ìœ¼ë¡œ ì „í™˜
            setTimeout(() => {
                document.getElementById('splashScreen').style.display = 'none';
                document.getElementById('appContainer').classList.add('visible');
                initializeApp();
            }, 2000);
        });

        // í”„ë¡œì íŠ¸ ë°ì´í„° ë¡œë“œ
        async function loadProjectData() {
            if (!currentProject) return;
            
            try {
                // í”„ë¡œì íŠ¸ íŒŒì¼ ìŠ¤ìº”
                await loadProjectFiles();
                
                // ì»¤ë°‹ íˆìŠ¤í† ë¦¬ ë¡œë“œ
                await loadCommitHistory();
                
                // DGit ìƒíƒœ í™•ì¸
                await updateProjectStatus();
                
            } catch (error) {
                console.error('í”„ë¡œì íŠ¸ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
                showToast('í”„ë¡œì íŠ¸ ë°ì´í„°ë¥¼ ë¡œë“œí•˜ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤', 'error');
            }
        }

        // í”„ë¡œì íŠ¸ íŒŒì¼ ë¡œë“œ
        async function loadProjectFiles() {
            if (!currentProject) return;
            
            try {
                const result = await window.electron.scanDirectory(currentProject.path);
                
                if (result.success) {
                    const files = result.files.map(file => ({
                        name: file.name,
                        type: file.type,
                        size: formatFileSize(file.size),
                        modified: formatDate(file.modified),
                        status: 'unknown', // ìƒíƒœëŠ” ë³„ë„ë¡œ í™•ì¸
                        path: file.path
                    }));
                    
                    // DGit ìƒíƒœë¡œ íŒŒì¼ ìƒíƒœ ì—…ë°ì´íŠ¸
                    await updateFileStatuses(files);
                    renderFiles(files);
                } else {
                    showToast('íŒŒì¼ì„ ìŠ¤ìº”í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤', 'error');
                }
            } catch (error) {
                console.error('íŒŒì¼ ë¡œë“œ ì‹¤íŒ¨:', error);
                showToast('íŒŒì¼ ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤', 'error');
            }
        }

        // ì»¤ë°‹ íˆìŠ¤í† ë¦¬ ë¡œë“œ
        async function loadCommitHistory() {
            if (!currentProject) return;
            
            try {
                const result = await window.electron.dgit.log(currentProject.path, 10);
                
                if (result.success) {
                    const commits = parseCommitLog(result.output);
                    renderCommits(commits);
                } else {
                    // ì €ì¥ì†Œê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì€ ê²½ìš°
                    renderCommits([]);
                }
            } catch (error) {
                console.error('ì»¤ë°‹ íˆìŠ¤í† ë¦¬ ë¡œë“œ ì‹¤íŒ¨:', error);
                renderCommits([]);
            }
        }

        // í”„ë¡œì íŠ¸ ìƒíƒœ ì—…ë°ì´íŠ¸
        async function updateProjectStatus() {
            if (!currentProject) return;
            
            try {
                const result = await window.electron.dgit.status(currentProject.path);
                
                if (result.success) {
                    updateTerminalStatus(result.output);
                } else {
                    updateTerminalStatus('DGit ì €ì¥ì†Œê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                console.error('ìƒíƒœ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:', error);
                updateTerminalStatus('ìƒíƒœë¥¼ í™•ì¸í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            }
        }

        // íŒŒì¼ ëª©ë¡ ë Œë”ë§
        function renderFiles(files) {
            const fileList = document.getElementById('fileList');
            fileList.innerHTML = files.map(file => `
                <div class="file-item" onclick="previewFile('${file.name}')">
                    <div class="file-thumbnail">${getFileIcon(file.type)}</div>
                    <div class="file-info">
                        <div class="file-name">${file.name}</div>
                        <div class="file-details">${file.size} â€¢ ${file.modified}</div>
                    </div>
                    <div class="file-status" style="background: ${getStatusColor(file.status)}"></div>
                </div>
            `).join('');
        }

        // ì»¤ë°‹ ëª©ë¡ ë Œë”ë§
        function renderCommits(commits) {
            const commitList = document.getElementById('commitList');
            commitList.innerHTML = commits.map(commit => `
                <div class="commit-item" onclick="viewCommit('${commit.hash}')">
                    <div class="commit-avatar">${commit.author[0]}</div>
                    <div class="commit-details">
                        <div class="commit-message">${commit.message}</div>
                        <div class="commit-meta">
                            <span>${commit.date}</span>
                            <span>${commit.hash}</span>
                            <span>${commit.files}ê°œ íŒŒì¼</span>
                        </div>
                    </div>
                    <div class="commit-thumbnail"></div>
                </div>
            `).join('');
        }

        // íŒŒì¼ ì•„ì´ì½˜ ê°€ì ¸ì˜¤ê¸°
        function getFileIcon(type) {
            const icons = {
                'psd': 'ğŸ¨',
                'ai': 'ğŸ–Œï¸',
                'sketch': 'âœï¸',
                'figma': 'ğŸ¯',
                'xd': 'ğŸ’œ',
                'png': 'ğŸ–¼ï¸',
                'jpg': 'ğŸ“¸',
                'svg': 'ğŸ­'
            };
            return icons[type] || 'ğŸ“„';
        }

        // íŒŒì¼ ìƒíƒœ ìƒ‰ìƒ ê°€ì ¸ì˜¤ê¸°
        function getStatusColor(status) {
            const colors = {
                'modified': 'var(--accent-orange)',
                'staged': 'var(--accent-blue)', 
                'committed': 'var(--accent-green)',
                'added': 'var(--accent-green)',
                'deleted': 'var(--accent-red)',
                'untracked': 'var(--text-secondary)',
                'unknown': 'var(--text-secondary)'
            };
            return colors[status] || 'var(--text-secondary)';
        }

        // ì•± ì´ˆê¸°í™”
        async function initializeApp() {
            try {
                // ì„¤ì • ë¡œë“œ
                await loadAppConfig();
                
                // ìµœê·¼ í”„ë¡œì íŠ¸ ë¡œë“œ
                await loadRecentProjects();
                
                console.log('ì•± ì´ˆê¸°í™” ì™„ë£Œ');
            } catch (error) {
                console.error('ì•± ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
            }
        }

        // ì•± ì„¤ì • ë¡œë“œ
        async function loadAppConfig() {
            try {
                const result = await window.electron.config.load();
                if (result.success) {
                    const config = result.config;
                    if (config.theme && config.theme !== currentTheme) {
                        currentTheme = config.theme;
                        document.body.setAttribute('data-theme', currentTheme);
                        updateThemeUI();
                    }
                }
            } catch (error) {
                console.error('ì„¤ì • ë¡œë“œ ì‹¤íŒ¨:', error);
            }
        }

        // ìµœê·¼ í”„ë¡œì íŠ¸ ë¡œë“œ
        async function loadRecentProjects() {
            try {
                const result = await window.electron.recentProjects.load();
                if (result.success) {
                    window.recentProjectsList = result.projects || [];
                }
            } catch (error) {
                console.error('ìµœê·¼ í”„ë¡œì íŠ¸ ë¡œë“œ ì‹¤íŒ¨:', error);
                window.recentProjectsList = [];
            }
        }

        // íŒŒì¼ í¬ê¸° í¬ë§·íŒ…
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 B';
            const k = 1024;
            const sizes = ['B', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];
        }

        // ë‚ ì§œ í¬ë§·íŒ…
        function formatDate(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMs / 3600000);
            const diffDays = Math.floor(diffMs / 86400000);

            if (diffMins < 1) return 'ë°©ê¸ˆ ì „';
            if (diffMins < 60) return `${diffMins}ë¶„ ì „`;
            if (diffHours < 24) return `${diffHours}ì‹œê°„ ì „`;
            if (diffDays < 7) return `${diffDays}ì¼ ì „`;
            
            return date.toLocaleDateString('ko-KR');
        }

        // íŒŒì¼ ìƒíƒœ ì—…ë°ì´íŠ¸
        async function updateFileStatuses(files) {
            if (!currentProject) return;
            
            try {
                const result = await window.electron.dgit.status(currentProject.path);
                if (result.success) {
                    const statusMap = parseGitStatus(result.output);
                    
                    files.forEach(file => {
                        if (statusMap[file.name]) {
                            file.status = statusMap[file.name];
                        } else {
                            file.status = 'committed';
                        }
                    });
                }
            } catch (error) {
                console.error('íŒŒì¼ ìƒíƒœ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:', error);
            }
        }

        // Git ìƒíƒœ ì¶œë ¥ íŒŒì‹±
        function parseGitStatus(output) {
            const statusMap = {};
            const lines = output.split('\n');
            
            for (const line of lines) {
                const trimmed = line.trim();
                if (!trimmed) continue;
                
                // DGit ìƒíƒœ ì¶œë ¥ í˜•ì‹ íŒŒì‹±
                const match = trimmed.match(/^([MAD?!])\s+(.+)$/);
                if (match) {
                    const [, statusCode, filename] = match;
                    const status = getGitStatusText(statusCode);
                    statusMap[filename] = status;
                }
            }
            
            return statusMap;
        }

        // Git ìƒíƒœ ì½”ë“œë¥¼ í…ìŠ¤íŠ¸ë¡œ ë³€í™˜
        function getGitStatusText(statusCode) {
            const statusMap = {
                'M': 'modified',
                'A': 'added', 
                'D': 'deleted',
                'R': 'renamed',
                'C': 'copied',
                'U': 'updated',
                '?': 'untracked',
                '!': 'ignored'
            };
            return statusMap[statusCode] || 'unknown';
        }

        // ì»¤ë°‹ ë¡œê·¸ íŒŒì‹±
        function parseCommitLog(output) {
            const commits = [];
            if (!output || !output.trim()) return commits;
            
            const lines = output.split('\n');
            let currentCommit = null;
            
            for (const line of lines) {
                if (line.startsWith('commit ')) {
                    if (currentCommit) {
                        commits.push(currentCommit);
                    }
                    // DGit í˜•ì‹: "commit 4ea7d8384946 (v2)"
                    const commitMatch = line.match(/commit\s+([a-f0-9]+)\s*\(([^)]+)\)/);
                    if (commitMatch) {
                        currentCommit = {
                            hash: commitMatch[1].substring(0, 7),
                            version: commitMatch[2],
                            message: '',
                            author: '',
                            date: '',
                            files: 0
                        };
                    }
                } else if (line.startsWith('Author: ') && currentCommit) {
                    currentCommit.author = line.substring(8).trim();
                } else if (line.startsWith('Date: ') && currentCommit) {
                    const dateStr = line.substring(6).trim();
                    currentCommit.date = formatCommitDate(dateStr);
                } else if (line.startsWith('    ') && currentCommit && !currentCommit.message) {
                    // ì»¤ë°‹ ë©”ì‹œì§€ëŠ” 4ê°œ ê³µë°±ìœ¼ë¡œ ë“¤ì—¬ì“°ê¸°ë¨
                    currentCommit.message = line.trim();
                } else if (line.startsWith('    Files: ') && currentCommit) {
                    const filesMatch = line.match(/Files:\s+(\d+)/);
                    if (filesMatch) {
                        currentCommit.files = parseInt(filesMatch[1]);
                    }
                }
            }
            
            if (currentCommit) {
                commits.push(currentCommit);
            }
            
            return commits;
        }

        // ì»¤ë°‹ ë‚ ì§œ í¬ë§·íŒ…
        function formatCommitDate(dateStr) {
            try {
                const date = new Date(dateStr);
                return formatDate(date);
            } catch (error) {
                return dateStr;
            }
        }

        // í„°ë¯¸ë„ ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateTerminalStatus(statusOutput) {
            const terminalStatus = document.getElementById('terminalStatus');
            if (terminalStatus) {
                terminalStatus.innerHTML = `<pre style="margin: 0; font-family: inherit;">${statusOutput}</pre>`;
            }
        }

        // í…Œë§ˆ UI ì—…ë°ì´íŠ¸
        function updateThemeUI() {
            const themeIcon = document.getElementById('themeIcon');
            const themeText = document.getElementById('themeText');
            
            if (currentTheme === 'light') {
                if (themeIcon) themeIcon.textContent = 'ğŸŒ';
                if (themeText) themeText.textContent = 'ë‹¤í¬ ëª¨ë“œë¡œ ì „í™˜';
            } else {
                if (themeIcon) themeIcon.textContent = 'ğŸŒ™';
                if (themeText) themeText.textContent = 'ë¼ì´íŠ¸ ëª¨ë“œë¡œ ì „í™˜';
            }
        }

        // í…Œë§ˆ í† ê¸€
        function toggleTheme() {
            currentTheme = currentTheme === 'dark' ? 'light' : 'dark';
            document.body.setAttribute('data-theme', currentTheme);
            
            const themeIcon = document.getElementById('themeIcon');
            const themeText = document.getElementById('themeText');
            
            if (currentTheme === 'light') {
                themeIcon.textContent = 'ğŸŒ';
                if (themeText) themeText.textContent = 'ë‹¤í¬ ëª¨ë“œë¡œ ì „í™˜';
            } else {
                themeIcon.textContent = 'ğŸŒ™';
                if (themeText) themeText.textContent = 'ë¼ì´íŠ¸ ëª¨ë“œë¡œ ì „í™˜';
            }
            
            showToast('í…Œë§ˆê°€ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
        }

        // íŠ¸ë˜í”½ ë¼ì´íŠ¸ ë²„íŠ¼ í•¨ìˆ˜ë“¤
        function closeApp() {
            if (window.electron) {
                window.electron.closeApp();
            } else {
                window.close();
            }
        }

        function minimizeApp() {
            if (window.electron) {
                window.electron.minimizeApp();
            }
        }

        function maximizeApp() {
            if (window.electron) {
                window.electron.maximizeApp();
            }
        }

        // í™ˆ í™”ë©´ ë²„íŠ¼ í•¨ìˆ˜ë“¤
        async function selectNewProject() {
            try {
                // ë¨¼ì € DGit CLI ì‚¬ìš© ê°€ëŠ¥ ì—¬ë¶€ í™•ì¸
                const isDGitAvailable = await checkDGitAvailability();
                
                if (!isDGitAvailable) {
                    showModal('DGit CLI ì—†ìŒ', 'DGit CLIë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤', `
                        <div style="padding: 20px; text-align: center;">
                            <p style="margin-bottom: 20px; color: var(--text-secondary);">
                                DGit CLIê°€ ì„¤ì¹˜ë˜ì–´ ìˆì§€ ì•Šê±°ë‚˜ ê²½ë¡œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.<br>
                                ê·¸ë˜ë„ í”„ë¡œì íŠ¸ë¥¼ ì—´ì–´ì„œ íŒŒì¼ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                            </p>
                            <button class="btn btn-primary" onclick="selectProjectWithoutDGit()">
                                DGit ì—†ì´ í”„ë¡œì íŠ¸ ì—´ê¸°
                            </button>
                        </div>
                    `);
                    return;
                }

                const result = await window.electron.selectFolder();
                
                if (result.success) {
                    const projectInfo = {
                        name: result.name,
                        path: result.path
                    };
                    
                    // DGit ì €ì¥ì†Œ ì´ˆê¸°í™” í™•ì¸
                    const isRepo = await checkIfRepository(result.path);
                    
                    if (!isRepo) {
                        showModal('DGit ì €ì¥ì†Œ ì´ˆê¸°í™”', 'ì´ í´ë”ëŠ” DGit ì €ì¥ì†Œê°€ ì•„ë‹™ë‹ˆë‹¤', `
                            <div style="padding: 20px;">
                                <p style="margin-bottom: 20px; color: var(--text-secondary);">
                                    ì„ íƒí•œ í´ë”ì— DGit ì €ì¥ì†Œë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?<br>
                                    ë˜ëŠ” DGit ì—†ì´ íŒŒì¼ë§Œ í™•ì¸í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.
                                </p>
                                <div style="background: var(--bg-tertiary); padding: 12px; border-radius: 6px; margin-bottom: 20px;">
                                    <strong>í´ë”:</strong> ${result.path}
                                </div>
                                <div style="display: flex; gap: 12px; justify-content: center;">
                                    <button class="btn btn-primary" onclick="initializeRepository(${JSON.stringify(projectInfo).replace(/"/g, '&quot;')})">
                                        DGit ì €ì¥ì†Œ ì´ˆê¸°í™”
                                    </button>
                                    <button class="btn btn-secondary" onclick="openProjectWithoutDGit(${JSON.stringify(projectInfo).replace(/"/g, '&quot;')})">
                                        DGit ì—†ì´ ì—´ê¸°
                                    </button>
                                </div>
                            </div>
                        `);
                    } else {
                        await openProject(projectInfo);
                    }
                } else {
                    showToast('í´ë” ì„ íƒì´ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤', 'warning');
                }
            } catch (error) {
                console.error('í”„ë¡œì íŠ¸ ì„ íƒ ì‹¤íŒ¨:', error);
                showToast('í”„ë¡œì íŠ¸ ì„ íƒ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤', 'error');
            }
        }

        // DGit ì—†ì´ í”„ë¡œì íŠ¸ ì„ íƒ
        async function selectProjectWithoutDGit() {
            closeModal();
            
            try {
                const result = await window.electron.selectFolder();
                
                if (result.success) {
                    const projectInfo = {
                        name: result.name,
                        path: result.path
                    };
                    
                    await openProjectWithoutDGit(projectInfo);
                } else {
                    showToast('í´ë” ì„ íƒì´ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤', 'warning');
                }
            } catch (error) {
                console.error('í”„ë¡œì íŠ¸ ì„ íƒ ì‹¤íŒ¨:', error);
                showToast('í”„ë¡œì íŠ¸ ì„ íƒ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤', 'error');
            }
        }

        // DGit ê¸°ëŠ¥ ì—†ì´ í”„ë¡œì íŠ¸ ì—´ê¸°
        async function openProjectWithoutDGit(projectInfo) {
            closeModal();
            
            currentProject = projectInfo;
            document.getElementById('homeScreen').style.display = 'none';
            document.getElementById('workspace').classList.add('active');
            document.getElementById('titleText').textContent = `DGit MAC - ${projectInfo.name} (DGit ì—†ìŒ)`;
            document.getElementById('projectName').textContent = projectInfo.name;
            document.getElementById('projectPath').textContent = projectInfo.path;
            
            // ìµœê·¼ í”„ë¡œì íŠ¸ì— ì €ì¥
            try {
                await window.electron.recentProjects.save(projectInfo);
                await loadRecentProjects();
            } catch (error) {
                console.error('ìµœê·¼ í”„ë¡œì íŠ¸ ì €ì¥ ì‹¤íŒ¨:', error);
            }
            
            // íŒŒì¼ë§Œ ë¡œë“œ (DGit ê¸°ëŠ¥ ì œì™¸)
            await loadProjectFilesOnly();
            
            showToast(`í”„ë¡œì íŠ¸ '${projectInfo.name}'ì„ ì—´ì—ˆìŠµë‹ˆë‹¤ (DGit ê¸°ëŠ¥ ì—†ìŒ)`, 'warning');
        }

        // íŒŒì¼ë§Œ ë¡œë“œ (DGit ê¸°ëŠ¥ ì œì™¸)
        async function loadProjectFilesOnly() {
            if (!currentProject) return;
            
            try {
                const result = await window.electron.scanDirectory(currentProject.path);
                
                if (result.success) {
                    const files = result.files.map(file => ({
                        name: file.name,
                        type: file.type,
                        size: formatFileSize(file.size),
                        modified: formatDate(file.modified),
                        status: 'unknown',
                        path: file.path
                    }));
                    
                    renderFiles(files);
                    
                    // ë¹ˆ ì»¤ë°‹ íˆìŠ¤í† ë¦¬ì™€ ìƒíƒœ í‘œì‹œ
                    renderCommits([]);
                    updateTerminalStatus('DGit CLIë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. íŒŒì¼ ë³´ê¸°ë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
                } else {
                    showToast('íŒŒì¼ì„ ìŠ¤ìº”í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤', 'error');
                }
            } catch (error) {
                console.error('íŒŒì¼ ë¡œë“œ ì‹¤íŒ¨:', error);
                showToast('íŒŒì¼ ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤', 'error');
            }
        }

        async function openCurrentProject() {
            // ìµœê·¼ í”„ë¡œì íŠ¸ ëª©ë¡ì—ì„œ ê°€ì¥ ìµœê·¼ í”„ë¡œì íŠ¸ ê°€ì ¸ì˜¤ê¸°
            const recentProjects = window.recentProjectsList || [];
            
            if (recentProjects.length > 0) {
                const mostRecentProject = recentProjects[0];
                await openProject(mostRecentProject);
            } else {
                showToast('ì§„í–‰ ì¤‘ì¸ í”„ë¡œì íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤', 'warning');
            }
        }

        async function showRecentProjects() {
            const recentProjects = window.recentProjectsList || [];
            
            if (recentProjects.length === 0) {
                showModal('ì§€ë‚œ í”„ë¡œì íŠ¸', 'ìµœê·¼ ì‘ì—…í•œ í”„ë¡œì íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤', `
                    <div style="text-align: center; padding: 40px; color: var(--text-secondary);">
                        <p>ì•„ì§ ì‘ì—…í•œ í”„ë¡œì íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                        <p>ìƒˆ í”„ë¡œì íŠ¸ë¥¼ ì„ íƒí•˜ì—¬ ì‹œì‘í•´ë³´ì„¸ìš”.</p>
                    </div>
                `);
                return;
            }

            const projectList = recentProjects.map(project => `
                <div class="file-item" onclick="openRecentProject('${project.path}', '${project.name}')">
                    <div class="file-thumbnail">ğŸ“</div>
                    <div class="file-info">
                        <div class="file-name">${project.name}</div>
                        <div class="file-details">${project.path} â€¢ ${formatDate(project.lastOpened)}</div>
                    </div>
                </div>
            `).join('');

            showModal('ì§€ë‚œ í”„ë¡œì íŠ¸', 'ìµœê·¼ ì‘ì—…í•œ í”„ë¡œì íŠ¸ë¥¼ ì„ íƒí•˜ì„¸ìš”', `
                <div class="file-list">
                    ${projectList}
                </div>
            `);
        }

        // ì €ì¥ì†Œ í™•ì¸
        async function checkIfRepository(projectPath) {
            try {
                const result = await window.electron.dgit.status(projectPath);
                return result.success;
            } catch (error) {
                console.log('Repository check error:', error);
                return false;
            }
        }

        // DGit CLI ì‚¬ìš© ê°€ëŠ¥ ì—¬ë¶€ í™•ì¸
        async function checkDGitAvailability() {
            try {
                const result = await window.electron.dgit.command('help');
                return result.success;
            } catch (error) {
                return false;
            }
        }

        // ì €ì¥ì†Œ ì´ˆê¸°í™”
        async function initializeRepository(projectInfo) {
            closeModal();
            
            try {
                showToast('DGit ì €ì¥ì†Œë¥¼ ì´ˆê¸°í™”í•˜ëŠ” ì¤‘...', 'success');
                
                const result = await window.electron.dgit.init(projectInfo.path);
                
                if (result.success) {
                    showToast('DGit ì €ì¥ì†Œê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
                    await openProject(projectInfo);
                } else {
                    showToast('ì €ì¥ì†Œ ì´ˆê¸°í™”ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤', 'error');
                }
            } catch (error) {
                console.error('ì €ì¥ì†Œ ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
                showToast('ì €ì¥ì†Œ ì´ˆê¸°í™” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤', 'error');
            }
        }

        // í”„ë¡œì íŠ¸ ì—´ê¸°
        async function openProject(projectInfo) {
            currentProject = projectInfo;
            document.getElementById('homeScreen').style.display = 'none';
            document.getElementById('workspace').classList.add('active');
            document.getElementById('titleText').textContent = `DGit MAC - ${projectInfo.name}`;
            document.getElementById('projectName').textContent = projectInfo.name;
            document.getElementById('projectPath').textContent = projectInfo.path;
            
            // ìµœê·¼ í”„ë¡œì íŠ¸ì— ì €ì¥
            try {
                await window.electron.recentProjects.save(projectInfo);
                await loadRecentProjects(); // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
            } catch (error) {
                console.error('ìµœê·¼ í”„ë¡œì íŠ¸ ì €ì¥ ì‹¤íŒ¨:', error);
            }
            
            // í”„ë¡œì íŠ¸ ë°ì´í„° ë¡œë“œ
            await loadProjectData();
            
            showToast(`í”„ë¡œì íŠ¸ '${projectInfo.name}'ì„ ì—´ì—ˆìŠµë‹ˆë‹¤`, 'success');
        }

        function openRecentProject(path, name) {
            closeModal();
            openProject({ name, path });
        }

        // í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°
        function goHome() {
            document.getElementById('workspace').classList.remove('active');
            document.getElementById('homeScreen').style.display = 'flex';
            document.getElementById('titleText').textContent = 'DGit MAC';
            currentProject = null;
        }

        // ì‚¬ì´ë“œë°” ì½˜í…ì¸  í‘œì‹œ
        function showContent(contentType) {
            // ëª¨ë“  ì½˜í…ì¸  ì„¹ì…˜ ìˆ¨ê¸°ê¸°
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.add('hidden');
            });
            
            // ì‚¬ì´ë“œë°” í™œì„±í™” ìƒíƒœ ë³€ê²½
            document.querySelectorAll('.sidebar-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // ì„ íƒëœ ì½˜í…ì¸  í‘œì‹œ
            document.getElementById(`${contentType}Content`).classList.remove('hidden');
            event.target.classList.add('active');
            activeContent = contentType;
        }

        // í„°ë¯¸ë„ íƒ­ ì „í™˜
        function showTerminalTab(tabType) {
            document.querySelectorAll('.terminal-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            event.target.classList.add('active');
            
            if (tabType === 'log') {
                document.getElementById('terminalLog').classList.remove('hidden');
                document.getElementById('terminalStatus').classList.add('hidden');
            } else {
                document.getElementById('terminalLog').classList.add('hidden');
                document.getElementById('terminalStatus').classList.remove('hidden');
            }
        }

        // íŒŒì¼ ë¯¸ë¦¬ë³´ê¸°
        function previewFile(filename) {
            showModal('íŒŒì¼ ë¯¸ë¦¬ë³´ê¸°', filename, `
                <div style="text-align: center; padding: 40px;">
                    <div style="width: 200px; height: 150px; background: var(--bg-tertiary); border-radius: 8px; margin: 0 auto 20px; display: flex; align-items: center; justify-content: center; font-size: 3rem;">
                        ${getFileIcon(filename.split('.').pop())}
                    </div>
                    <p style="color: var(--text-secondary);">
                        ${filename}ì˜ ë¯¸ë¦¬ë³´ê¸°ì…ë‹ˆë‹¤.<br>
                        ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” ì´ë¯¸ì§€ ì¸ë„¤ì¼ì´ í‘œì‹œë©ë‹ˆë‹¤.
                    </p>
                </div>
            `);
        }

        // ì»¤ë°‹ ìƒì„¸ë³´ê¸°
        async function viewCommit(hash) {
            if (!currentProject) return;
            
            try {
                // ì‹¤ì œ ì»¤ë°‹ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
                const result = await window.electron.dgit.command('show', ['--name-only', hash], currentProject.path);
                
                let commitDetails = `
                    <div style="padding: 20px;">
                        <h4 style="margin-bottom: 16px;">ì»¤ë°‹ í•´ì‹œ: ${hash}</h4>
                `;
                
                if (result.success) {
                    const lines = result.output.split('\n');
                    const commitMessage = lines.find(line => line.trim() && !line.startsWith('commit') && !line.startsWith('Author') && !line.startsWith('Date')) || 'ì»¤ë°‹ ë©”ì‹œì§€ ì—†ìŒ';
                    
                    commitDetails += `
                        <h4 style="margin: 20px 0 16px 0;">ì»¤ë°‹ ë©”ì‹œì§€:</h4>
                        <p style="color: var(--text-secondary); background: var(--bg-tertiary); padding: 12px; border-radius: 6px;">
                            ${commitMessage}
                        </p>
                    `;
                } else {
                    commitDetails += `
                        <p style="color: var(--text-secondary);">ì»¤ë°‹ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
                    `;
                }
                
                commitDetails += `</div>`;
                
                showModal('ì»¤ë°‹ ìƒì„¸ì •ë³´', `ì»¤ë°‹ ${hash}`, commitDetails);
            } catch (error) {
                console.error('ì»¤ë°‹ ì •ë³´ ë¡œë“œ ì‹¤íŒ¨:', error);
                showModal('ì»¤ë°‹ ìƒì„¸ì •ë³´', `ì»¤ë°‹ ${hash}`, `
                    <div style="padding: 20px;">
                        <p style="color: var(--text-secondary);">ì»¤ë°‹ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>
                    </div>
                `);
            }
        }

        // í”„ë¡œì íŠ¸ ë³€ê²½
        async function changeProject() {
            await selectNewProject();
        }

        // í”„ë¡œì íŠ¸ ìŠ¤ìº”
        async function scanProject() {
            if (!currentProject) {
                showToast('í”„ë¡œì íŠ¸ê°€ ì„ íƒë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤', 'warning');
                return;
            }

            try {
                showToast('í”„ë¡œì íŠ¸ë¥¼ ìŠ¤ìº”í•˜ê³  ìˆìŠµë‹ˆë‹¤...', 'info');
                await loadProjectData();
                showToast('í”„ë¡œì íŠ¸ ìŠ¤ìº”ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
            } catch (error) {
                console.error('í”„ë¡œì íŠ¸ ìŠ¤ìº” ì‹¤íŒ¨:', error);
                showToast('í”„ë¡œì íŠ¸ ìŠ¤ìº” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤', 'error');
            }
        }

        // ëª¨ë“  íŒŒì¼ ì¶”ê°€
        async function addAllFiles() {
            if (!currentProject) {
                showToast('í”„ë¡œì íŠ¸ê°€ ì„ íƒë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤', 'warning');
                return;
            }

            try {
                const result = await window.electron.dgit.command('add', ['.'], currentProject.path);
                
                if (result.success) {
                    showToast('ëª¨ë“  íŒŒì¼ì´ ìŠ¤í…Œì´ì§• ì˜ì—­ì— ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
                    await loadProjectData(); // íŒŒì¼ ìƒíƒœ ìƒˆë¡œê³ ì¹¨
                } else {
                    showToast('íŒŒì¼ ì¶”ê°€ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤', 'error');
                }
            } catch (error) {
                console.error('íŒŒì¼ ì¶”ê°€ ì‹¤íŒ¨:', error);
                showToast('íŒŒì¼ ì¶”ê°€ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤', 'error');
            }
        }

        // íŒŒì¼ ë³µì›
        async function restoreFiles() {
            if (!currentProject) {
                showToast('í”„ë¡œì íŠ¸ê°€ ì„ íƒë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤', 'warning');
                return;
            }

            showModal('íŒŒì¼ ë³µì›', 'ë³€ê²½ì‚¬í•­ì„ ë³µì›í•˜ì‹œê² ìŠµë‹ˆê¹Œ?', `
                <div style="padding: 20px;">
                    <p style="margin-bottom: 20px; color: var(--text-secondary);">
                        ì´ ì‘ì—…ì€ ëª¨ë“  ë³€ê²½ì‚¬í•­ì„ ë§ˆì§€ë§‰ ì»¤ë°‹ ìƒíƒœë¡œ ë˜ëŒë¦½ë‹ˆë‹¤.<br>
                        <strong style="color: var(--accent-red);">ì£¼ì˜: ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</strong>
                    </p>
                    <div style="display: flex; gap: 12px; justify-content: center;">
                        <button class="btn btn-secondary" onclick="closeModal()">ì·¨ì†Œ</button>
                        <button class="btn btn-danger" onclick="performRestore()">ë³µì› ì‹¤í–‰</button>
                    </div>
                </div>
            `);
        }

        // ë³µì› ì‹¤í–‰
        async function performRestore() {
            closeModal();
            
            try {
                const result = await window.electron.dgit.command('restore', ['.'], currentProject.path);
                
                if (result.success) {
                    showToast('íŒŒì¼ì´ ë³µì›ë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
                    await loadProjectData(); // íŒŒì¼ ìƒíƒœ ìƒˆë¡œê³ ì¹¨
                } else {
                    showToast('íŒŒì¼ ë³µì› ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤', 'error');
                }
            } catch (error) {
                console.error('íŒŒì¼ ë³µì› ì‹¤íŒ¨:', error);
                showToast('íŒŒì¼ ë³µì› ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤', 'error');
            }
        }

        // Finderì—ì„œ ë³´ê¸°
        async function showInFinder() {
            if (!currentProject) {
                showToast('í”„ë¡œì íŠ¸ê°€ ì„ íƒë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤', 'warning');
                return;
            }

            try {
                const result = await window.electron.showInFinder(currentProject.path);
                
                if (result.success) {
                    showToast('Finderì—ì„œ í”„ë¡œì íŠ¸ í´ë”ë¥¼ ì—´ì—ˆìŠµë‹ˆë‹¤', 'success');
                } else {
                    showToast('Finderì—ì„œ ì—´ê¸° ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤', 'error');
                }
            } catch (error) {
                console.error('Finderì—ì„œ ë³´ê¸° ì‹¤íŒ¨:', error);
                showToast('Finderì—ì„œ ì—´ê¸° ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤', 'error');
            }
        }

        // ë³€ê²½ì‚¬í•­ ì»¤ë°‹
        async function commitChanges() {
            if (!currentProject) {
                showToast('í”„ë¡œì íŠ¸ê°€ ì„ íƒë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤', 'warning');
                return;
            }

            try {
                // í˜„ì¬ ìƒíƒœ í™•ì¸
                const statusResult = await window.electron.dgit.status(currentProject.path);
                let statusInfo = 'ìƒíƒœë¥¼ í™•ì¸í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤';
                
                if (statusResult.success) {
                    const statusLines = statusResult.output.split('\n').filter(line => line.trim());
                    const modifiedCount = statusLines.filter(line => line.startsWith('M ')).length;
                    const addedCount = statusLines.filter(line => line.startsWith('A ')).length;
                    const deletedCount = statusLines.filter(line => line.startsWith('D ')).length;
                    const untrackedCount = statusLines.filter(line => line.startsWith('? ')).length;
                    
                    if (statusLines.length === 0) {
                        showToast('ì»¤ë°‹í•  ë³€ê²½ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤', 'warning');
                        return;
                    }
                    
                    statusInfo = `ë³€ê²½ëœ íŒŒì¼: ${statusLines.length}ê°œ`;
                    if (modifiedCount > 0) statusInfo += ` â€¢ ìˆ˜ì •: ${modifiedCount}ê°œ`;
                    if (addedCount > 0) statusInfo += ` â€¢ ì¶”ê°€: ${addedCount}ê°œ`;
                    if (deletedCount > 0) statusInfo += ` â€¢ ì‚­ì œ: ${deletedCount}ê°œ`;
                    if (untrackedCount > 0) statusInfo += ` â€¢ ì¶”ì ì•ˆë¨: ${untrackedCount}ê°œ`;
                }

                showModal('ë³€ê²½ì‚¬í•­ ì»¤ë°‹', 'ì»¤ë°‹ ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”', `
                    <div>
                        <textarea 
                            id="commitMessage" 
                            placeholder="ì»¤ë°‹ ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”..."
                            style="
                                width: 100%;
                                height: 100px;
                                background: var(--bg-secondary);
                                border: 1px solid var(--border-color);
                                border-radius: 6px;
                                padding: 12px;
                                color: var(--text-primary);
                                resize: vertical;
                                font-family: inherit;
                            "
                        ></textarea>
                        <div style="margin-top: 16px; color: var(--text-secondary); font-size: 0.9rem;">
                            ${statusInfo}
                        </div>
                    </div>
                `, () => {
                    const message = document.getElementById('commitMessage').value;
                    if (message.trim()) {
                        performCommit(message);
                    } else {
                        showToast('ì»¤ë°‹ ë©”ì‹œì§€ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”', 'warning');
                    }
                });
            } catch (error) {
                console.error('ì»¤ë°‹ ì¤€ë¹„ ì‹¤íŒ¨:', error);
                showToast('ì»¤ë°‹ ì¤€ë¹„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤', 'error');
            }
        }

        async function performCommit(message) {
            closeModal();
            
            if (!currentProject) {
                showToast('í”„ë¡œì íŠ¸ê°€ ì„ íƒë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤', 'error');
                return;
            }

            try {
                showToast('ë³€ê²½ì‚¬í•­ì„ ì»¤ë°‹í•˜ëŠ” ì¤‘...', 'success');
                
                // í„°ë¯¸ë„ì— ë¡œê·¸ ì¶”ê°€
                const terminalLog = document.getElementById('terminalLog');
                terminalLog.innerHTML += `
                    <div style="margin-bottom: 8px;">
                        <span style="color: var(--accent-blue);">â³</span> 
                        <span style="color: var(--text-secondary);">[${new Date().toLocaleTimeString()}]</span>
                        ì»¤ë°‹ ì‹œì‘: ${message}
                    </div>
                `;
                terminalLog.scrollTop = terminalLog.scrollHeight;

                const result = await window.electron.dgit.commit(currentProject.path, message);
                
                if (result.success) {
                    // ì„±ê³µ ë¡œê·¸ ì¶”ê°€
                    terminalLog.innerHTML += `
                        <div style="margin-bottom: 8px;">
                            <span style="color: var(--accent-green);">âœ“</span> 
                            <span style="color: var(--text-secondary);">[${new Date().toLocaleTimeString()}]</span>
                            ì»¤ë°‹ ì™„ë£Œ: ${message}
                        </div>
                    `;
                    terminalLog.scrollTop = terminalLog.scrollHeight;
                    
                    showToast('ì»¤ë°‹ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤ âœ…', 'success');
                    
                    // í”„ë¡œì íŠ¸ ë°ì´í„° ìƒˆë¡œê³ ì¹¨
                    await loadProjectData();
                } else {
                    // ì‹¤íŒ¨ ë¡œê·¸ ì¶”ê°€
                    terminalLog.innerHTML += `
                        <div style="margin-bottom: 8px;">
                            <span style="color: var(--accent-red);">âœ—</span> 
                            <span style="color: var(--text-secondary);">[${new Date().toLocaleTimeString()}]</span>
                            ì»¤ë°‹ ì‹¤íŒ¨: ${result.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'}
                        </div>
                    `;
                    terminalLog.scrollTop = terminalLog.scrollHeight;
                    
                    showToast(`ì»¤ë°‹ ì‹¤íŒ¨: ${result.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'}`, 'error');
                }
            } catch (error) {
                console.error('ì»¤ë°‹ ì‹¤í–‰ ì‹¤íŒ¨:', error);
                
                // ì—ëŸ¬ ë¡œê·¸ ì¶”ê°€
                const terminalLog = document.getElementById('terminalLog');
                terminalLog.innerHTML += `
                    <div style="margin-bottom: 8px;">
                        <span style="color: var(--accent-red);">âœ—</span> 
                        <span style="color: var(--text-secondary);">[${new Date().toLocaleTimeString()}]</span>
                        ì»¤ë°‹ ì˜¤ë¥˜: ${error.message}
                    </div>
                `;
                terminalLog.scrollTop = terminalLog.scrollHeight;
                
                showToast('ì»¤ë°‹ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤', 'error');
            }
        }

        // ë¸Œëœì¹˜ ìƒì„±
        async function createBranch() {
            if (!currentProject) {
                showToast('í”„ë¡œì íŠ¸ê°€ ì„ íƒë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤', 'warning');
                return;
            }

            try {
                // í˜„ì¬ ë¸Œëœì¹˜ í™•ì¸
                const currentBranchResult = await window.electron.dgit.command('branch', ['--show-current'], currentProject.path);
                let currentBranch = 'main';
                
                if (currentBranchResult.success && currentBranchResult.output.trim()) {
                    currentBranch = currentBranchResult.output.trim();
                }

                showModal('ìƒˆ ë¸Œëœì¹˜ ìƒì„±', 'ë¸Œëœì¹˜ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”', `
                    <div>
                        <input 
                            type="text" 
                            id="branchName" 
                            placeholder="feature/new-design"
                            style="
                                width: 100%;
                                padding: 12px;
                                background: var(--bg-secondary);
                                border: 1px solid var(--border-color);
                                border-radius: 6px;
                                color: var(--text-primary);
                                font-family: inherit;
                            "
                        />
                        <div style="margin-top: 16px; color: var(--text-secondary); font-size: 0.9rem;">
                            í˜„ì¬ ë¸Œëœì¹˜: ${currentBranch}ì—ì„œ ë¶„ê¸°ë©ë‹ˆë‹¤
                        </div>
                    </div>
                `, () => {
                    const branchName = document.getElementById('branchName').value;
                    if (branchName.trim()) {
                        createNewBranch(branchName);
                    } else {
                        showToast('ë¸Œëœì¹˜ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”', 'warning');
                    }
                });
            } catch (error) {
                console.error('ë¸Œëœì¹˜ ìƒì„± ì¤€ë¹„ ì‹¤íŒ¨:', error);
                showToast('ë¸Œëœì¹˜ ìƒì„± ì¤€ë¹„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤', 'error');
            }
        }

        async function createNewBranch(name) {
            closeModal();
            
            if (!currentProject) {
                showToast('í”„ë¡œì íŠ¸ê°€ ì„ íƒë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤', 'error');
                return;
            }

            try {
                showToast('ë¸Œëœì¹˜ë¥¼ ìƒì„±í•˜ëŠ” ì¤‘...', 'success');
                
                const result = await window.electron.dgit.createBranch(currentProject.path, name);
                
                if (result.success) {
                    showToast(`ë¸Œëœì¹˜ '${name}'ê°€ ìƒì„±ë˜ê³  ì „í™˜ë˜ì—ˆìŠµë‹ˆë‹¤`, 'success');
                    
                    // í„°ë¯¸ë„ì— ë¡œê·¸ ì¶”ê°€
                    const terminalLog = document.getElementById('terminalLog');
                    terminalLog.innerHTML += `
                        <div style="margin-bottom: 8px;">
                            <span style="color: var(--accent-green);">âœ“</span> 
                            <span style="color: var(--text-secondary);">[${new Date().toLocaleTimeString()}]</span>
                            ë¸Œëœì¹˜ '${name}' ìƒì„± ë° ì „í™˜ ì™„ë£Œ
                        </div>
                    `;
                    terminalLog.scrollTop = terminalLog.scrollHeight;
                    
                    // ë¸Œëœì¹˜ ê·¸ë˜í”„ ì—…ë°ì´íŠ¸ (ê°„ë‹¨í•œ ì‹œê°í™”)
                    updateBranchGraph();
                } else {
                    showToast(`ë¸Œëœì¹˜ ìƒì„± ì‹¤íŒ¨: ${result.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'}`, 'error');
                }
            } catch (error) {
                console.error('ë¸Œëœì¹˜ ìƒì„± ì‹¤íŒ¨:', error);
                showToast('ë¸Œëœì¹˜ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤', 'error');
            }
        }

        // ë¸Œëœì¹˜ ê·¸ë˜í”„ ì—…ë°ì´íŠ¸
        async function updateBranchGraph() {
            if (!currentProject) return;
            
            try {
                const result = await window.electron.dgit.listBranches(currentProject.path);
                
                if (result.success) {
                    const branchGraph = document.getElementById('branchGraph');
                    branchGraph.innerHTML = ''; // ê¸°ì¡´ ë‚´ìš© ì œê±°
                    
                    const branches = result.output.split('\n')
                        .map(line => line.trim())
                        .filter(line => line && !line.startsWith('*'))
                        .map(line => line.replace(/^\*\s*/, ''));
                    
                    branches.forEach((branch, index) => {
                        const newNode = document.createElement('div');
                        newNode.className = 'branch-node';
                        newNode.style.left = (index * 80 + 50) + 'px';
                        newNode.style.top = (Math.sin(index) * 30 + 100) + 'px';
                        newNode.title = branch;
                        branchGraph.appendChild(newNode);
                    });
                }
            } catch (error) {
                console.error('ë¸Œëœì¹˜ ê·¸ë˜í”„ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:', error);
            }
        }

        // ëª¨ë‹¬ ê´€ë ¨ í•¨ìˆ˜ë“¤
        function showModal(title, subtitle, body, confirmCallback = null) {
            document.getElementById('modalTitle').textContent = title;
            document.getElementById('modalSubtitle').textContent = subtitle;
            document.getElementById('modalBody').innerHTML = body;
            document.getElementById('modalOverlay').classList.add('show');
            
            // í™•ì¸ ë²„íŠ¼ ì½œë°± ì„¤ì •
            window.currentModalCallback = confirmCallback;
        }

        function closeModal() {
            document.getElementById('modalOverlay').classList.remove('show');
            window.currentModalCallback = null;
        }

        function confirmModal() {
            if (window.currentModalCallback) {
                window.currentModalCallback();
            } else {
                closeModal();
            }
        }

        // í† ìŠ¤íŠ¸ ì•Œë¦¼
        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            
            const icon = type === 'success' ? 'âœ…' : type === 'error' ? 'âŒ' : 'âš ï¸';
            toast.innerHTML = `
                <span>${icon}</span>
                <span>${message}</span>
            `;
            
            document.getElementById('toastContainer').appendChild(toast);
            
            // 3ì´ˆ í›„ ìë™ ì œê±°
            setTimeout(() => {
                toast.style.animation = 'toastSlideIn 0.3s ease reverse';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤
        document.addEventListener('keydown', function(e) {
            if (e.metaKey || e.ctrlKey) {
                switch(e.key) {
                    case 'o':
                        e.preventDefault();
                        if (document.getElementById('homeScreen').style.display !== 'none') {
                            selectNewProject();
                        }
                        break;
                    case 's':
                        e.preventDefault();
                        if (currentProject) {
                            commitChanges();
                        }
                        break;
                    case 'w':
                        e.preventDefault();
                        goHome();
                        break;
                    case 'r':
                        e.preventDefault();
                        showToast('ìƒíƒœë¥¼ ìƒˆë¡œê³ ì¹¨í–ˆìŠµë‹ˆë‹¤', 'success');
                        break;
                }
            }
            
            if (e.key === 'Escape') {
                if (document.getElementById('modalOverlay').classList.contains('show')) {
                    closeModal();
                } else if (currentProject) {
                    goHome();
                }
            }
        });

        // ëª¨ë‹¬ ì˜¤ë²„ë ˆì´ í´ë¦­ì‹œ ë‹«ê¸°
        document.getElementById('modalOverlay').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal();
            }
        });
    </script>
</body>
</html>